1. 모델 전환 안되는중 


대화를 하다가 중간에 모델을 바꾸고 메세지를 보내면 바로 직전의 ai 메세지 답변의 모델 표시가 현재 메세지의 모델로 잠깐 바꼈다가 다시 돌아가는 버그가 있어. 예를들어 다음과 같은 대화가 있다고 생각해봐:

사용자: "안녕?"
AI: "네 안녕하세요." (claude sonnet 3.5 사용)
사용자: "넌 누구니?"
AI: "저는 Ai입니다." (gpt-4 사용)

이런 대화의 경우 사용자가 "넌 누구니?" 라는 메세지를 보내기전에 gpt-4 사용을 설정하면, "네 안녕하세요." 라고 답했던 ai에 사용했던 모델이 claude sonnet 3.5임에도 불구하고 사용자가 메세지를 전송한 후와 ai가 답변을 시작하기 전 사이, 즉, "stop" 사인이 나오는동안  잠깐 gpt-4로 바뀌었다가 다시 claude sonnet 3.5로 돌아가는 버그가 있어. 이 문제의 근본적인 원인이 무엇인지 파악해보고 해결해줘. 

단, 주의할점이 현재 구현된 모든 기능, 프로세스 혹은 UI조차도 완벽하게 유지하면서 저 버그만 고쳐야해. 

단계별로 차근히 생각해. 



2. 사용자의 메세지 인풋이 길면 두번씩 저장되는중 
3. 이미지 인풋
